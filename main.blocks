<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="q-?~^.dMp1%C+G9TRSDa">uvi</variable><variable id="B.`28aH)Y[D]eQ+7D-$I">refVal</variable><variable id="[~h2zy*H#3cW]C/lnWa@">VEML6070_ADDR_ARA</variable><variable id="qDST727XnX1aHTGSJ:OS">buf</variable><variable id="udQWk=P=OzVsgvB1,_$d">VEML6070_ADDR_H</variable><variable id="~he`?fft@{q46uW]DJ}h">VEML6070_ADDR_L</variable><variable id="fBP|my$k1ihH6nvY/ybS">INTEGRATION_TIME_1_T</variable><variable id="H62)+a~wGRLXNAVpTa*,">INTEGRATION_TIME_2_T</variable><variable id="#]7C*g9f):.G,7?Q7prW">INTEGRATION_TIME_4_T</variable><variable id="[4nY9T/ggAh/r/[%Zw+4">MSB</variable><variable id="+pE^SH0N=0Cs,T%pz!}4">LSB</variable></variables><block type="function_definition" x="10" y="10"><mutation name="getUVI" functionid=".-Dyn?j?wE,AfnupoZ(l"><arg name="uv" id="fo6plsf5tso9jl9qgk4q" type="number"></arg></mutation><field name="function_name">getUVI</field><statement name="STACK"><block type="variables_set"><field name="VAR" id="q-?~^.dMp1%C+G9TRSDa">uvi</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get"><field name="VAR" id="B.`28aH)Y[D]eQ+7D-$I">refVal</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="argument_reporter_number"><field name="VALUE">uv</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">5.625</field></shadow></value></block></value></block></value><value name="B"><shadow type="math_number"><field name="NUM">1000</field></shadow></value></block></value><next><block type="variables_set"><field name="VAR" id="q-?~^.dMp1%C+G9TRSDa">uvi</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get"><field name="VAR" id="q-?~^.dMp1%C+G9TRSDa">uvi</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0.04</field></shadow></value></block></value><next><block type="function_return"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get"><field name="VAR" id="q-?~^.dMp1%C+G9TRSDa">uvi</field></block></value></block></next></block></next></block></statement></block><block type="function_definition" x="10" y="10"><mutation name="init_uv" functionid="p_YTK{v:w@a)u]GWFn^-"></mutation><field name="function_name">init_uv</field><statement name="STACK"><block type="function_call"><mutation name="set_Reg_uv" functionid="z}D,DvEQSAVpm$)@-j0G"><arg name="command" id="180q4jkl8gfp1qrq0xcpqq" type="number"></arg></mutation><value name="180q4jkl8gfp1qrq0xcpqq"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get"><field name="VAR" id="[~h2zy*H#3cW]C/lnWa@">VEML6070_ADDR_ARA</field></block></value><next><block type="device_pause"><value name="pause"><shadow type="timePicker"><field name="ms">10</field></shadow></value></block></next></block></statement></block><block type="function_definition" x="10" y="10"><mutation name="set_Reg_uv" functionid="z}D,DvEQSAVpm$)@-j0G"><arg name="command" id="180q4jkl8gfp1qrq0xcpqq" type="number"></arg></mutation><field name="function_name">set_Reg_uv</field><statement name="STACK"><block type="typescript_statement" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let buf = pins.createBuffer(2);" numlines="1" declaredvars="buf"></mutation><next><block type="lists_index_set"><comment pinned="false" h="80" w="160">basic.pause(10)
basic.pause(10)
basic.pause(10)
basic.pause(10)</comment><value name="LIST"><block type="variables_get"><field name="VAR" id="qDST727XnX1aHTGSJ:OS">buf</field></block></value><value name="INDEX"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="VALUE"><block type="typescript_expression" editable="false"><field name="EXPRESSION">command &gt;&gt; 8</field></block></value><next><block type="lists_index_set"><value name="LIST"><block type="variables_get"><field name="VAR" id="qDST727XnX1aHTGSJ:OS">buf</field></block></value><value name="INDEX"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="VALUE"><block type="typescript_expression" editable="false"><field name="EXPRESSION">command &amp; 0x03</field></block></value><next><block type="function_return"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="typescript_expression" editable="false"><field name="EXPRESSION">pins.i2cWriteBuffer(VEML6070_ADDR_L, buf)</field></block></value></block></next></block></next></block></next></block></statement></block><block type="pxt-on-start" x="20" y="20"><statement name="HANDLER"><block type="typescript_statement" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let fnl = 0" numlines="1" declaredvars="fnl"></mutation><next><block type="variables_set"><field name="VAR" id="udQWk=P=OzVsgvB1,_$d">VEML6070_ADDR_H</field><value name="VALUE"><shadow type="math_number"><field name="NUM">57</field></shadow></value><next><block type="variables_set"><field name="VAR" id="~he`?fft@{q46uW]DJ}h">VEML6070_ADDR_L</field><value name="VALUE"><shadow type="math_number"><field name="NUM">56</field></shadow></value><next><block type="variables_set"><field name="VAR" id="fBP|my$k1ihH6nvY/ybS">INTEGRATION_TIME_1_T</field><value name="VALUE"><shadow type="math_number"><field name="NUM">1</field></shadow></value><next><block type="variables_set"><field name="VAR" id="H62)+a~wGRLXNAVpTa*,">INTEGRATION_TIME_2_T</field><value name="VALUE"><shadow type="math_number"><field name="NUM">2</field></shadow></value><next><block type="variables_set"><field name="VAR" id="#]7C*g9f):.G,7?Q7prW">INTEGRATION_TIME_4_T</field><value name="VALUE"><shadow type="math_number"><field name="NUM">3</field></shadow></value><next><block type="variables_set"><field name="VAR" id="[~h2zy*H#3cW]C/lnWa@">VEML6070_ADDR_ARA</field><value name="VALUE"><shadow type="math_number"><field name="NUM">12</field></shadow></value><next><block type="variables_set"><field name="VAR" id="[4nY9T/ggAh/r/[%Zw+4">MSB</field><value name="VALUE"><shadow type="math_number"><field name="NUM">115</field></shadow></value><next><block type="variables_set"><field name="VAR" id="+pE^SH0N=0Cs,T%pz!}4">LSB</field><value name="VALUE"><shadow type="math_number"><field name="NUM">113</field></shadow></value><next><block type="variables_set"><field name="VAR" id="B.`28aH)Y[D]eQ+7D-$I">refVal</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0.4</field></shadow></value><next><block type="typescript_statement" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace CIPUV {" line1="    init_uv();" line2="    /**" line3="        * Returns a number describing the UV radiation(UVI) " line4="    */" line5="    //% blockId=&quot;VEML6070&quot;" line6="    //% block=&quot;Leer UV&quot;" line7="    export function UVI(): number {" line8="" line9="        set_Reg_uv(MSB);" line10="        basic.pause(100);" line11="        let i2cBuffer = pins.i2cReadBuffer(VEML6070_ADDR_L, pins.sizeOf(NumberFormat.UInt8LE) * 7, false);" line12="        let result = i2cBuffer[0] &lt;&lt; 8;" line13="        result |= i2cBuffer[1];" line14="        //basic.showNumber(result);" line15="        basic.pause(100);" line16="        set_Reg_uv(LSB);" line17="        basic.pause(100);" line18="        let i2cBuff = pins.i2cReadBuffer(VEML6070_ADDR_L, pins.sizeOf(NumberFormat.UInt8LE) * 7, false);" line19="        let res = i2cBuff[0] &lt;&lt; 8;" line20="        res |= i2cBuff[1];" line21="" line22="        //basic.showNumber(getUVI(res + result));" line23="        fnl = getUVI(res + result);" line24="        //basic.pause(1000);" line25="        return fnl" line26="    }" line27="}" numlines="28"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>